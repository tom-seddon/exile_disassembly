10REM>EXSPRS220MODE12930FORI%=0TO15:VDU23,224+I%:FORJ%=0TO4:VDUVAL(MID$("75557.62227.71747.71717.55711.74717.74757.71111.75757.75711.75755.65656.74447.65556.74747.74744",1+I%*6+J%,1)):NEXT:VDU0,0,0:NEXT40DIMBUF 4096,BLK 13,CODE 50,RAW 128*8150CLOSE#0:?BLK=OPENIN"EXILEB":BLK!1=BUF:BLK!5=3092:BLK!9=&52EC:X%=BLK:Y%=BLK DIV256:A%=3:CALL&FFD1:CLOSE#?BLK60:70R=&70:FORI%=0TO2STEP2:P%=CODE:[OPTI%:.UNPACK:LDX#0:STXR+0:STXR+1:STXR+2:STXR+3:JSRUNPACK2:.UNPACK2:ASLA:ROLR+0:ASLA:ROLR+1:ASLA:ROLR+2:ASLA:ROLR+3:RTS:]NEXT8090SD%=BUF:WD%=BUF+&A20:HD%=WD%+&7D:AD%=HD%+&7D:BD%=AD%+&7D100NSPRITES%=&7D110:120PRINT"Unpacking..."130SRC%=BUF:DEST%=RAW:FORI%=0TO&A1F:A%=?SRC%:SRC%=SRC%+1:CALLUNPACK:!DEST%=!R:DEST%=DEST%+4:NEXT140CLS150:160REM PROCSPRITE(0,0,128,80,0,16)170:171TIME=0180DESTX%=0:DESTY%=0:ROWH%=0190:200DIMXSPRITE%(&7C),YSPRITE%(&7C)210FORI%=0TONSPRITES%-1220W%=1+(WD%?I%)DIV16230H%=1+(HD%?I%)DIV8240B%=BD%?I%:Y%=(B%DIV8)OR((B%AND7)*32)250A%=AD%?I%:X%=(A%DIV64)OR((A%AND7)*4):X%=X%*4:X%=X%+((A%DIV16)AND3)260FULLW%=W%270IFFULLW%<8FULLW%=8280FULLW%=FULLW%+4290IF DESTX%+FULLW%>320DESTX%=0:DESTY%=DESTY%+ROWH%+8:ROWH%=0:GCOL0,3:MOVE0,FNY(DESTY%):PLOT17,1280,0:DESTY%=DESTY%+2300IFH%>ROWH%ROWH%=H%310XSPRITE%(I%)=DESTX%:YSPRITE%(I%)=DESTY%320PROCSPRITE(X%,Y%,W%,H%,DESTX%,DESTY%+6)330DESTX%=DESTX%+FULLW%340NEXT350:360VDU5370GCOL0,3380FORI%=0TONSPRITES%-1390X%=XSPRITE%(I%):Y%=FNY(YSPRITE%(I%))400MOVEFNX(X%-5),Y%:VDU224+(I%DIV16)410MOVEFNX(X%-1),Y%:VDU224+(I%AND15)420NEXT430VDU4440PRINTTAB(0,28);TIME/100;" ";450END460:470DEFFNX(X%)=X%*4480DEFFNY(Y%)=(255-Y%)*4490:500DEFPROCSPRITE(XS%,YS%,W%,H%,SX%,SY%)510LOCALA%,C%,I%,J%,X%,Y%520W%=W%-1:H%=H%-1530SX%=FNX(SX%):SY%=FNY(SY%)540FORC%=1TO3550GCOL0,C%560A%=RAW+XS%+YS%*128570Y%=SY%580FORI%=0TOH%590X%=SX%600FORJ%=0TOW%:IFA%?J%=C%PLOT69,X%,Y%620X%=X%+4:NEXT640A%=A%+128650Y%=Y%-4660NEXT670NEXT680ENDPROC